import{c as y,ad as fe,ae as me,U as pe,af as ve,ag as k,ah as ee,r as C,ai as we,aj as ye,ak as he,al as ge,V as je,S as Se,o as be,ab as Ee,am as Oe,a9 as Ce,an as Y,ao as B,ap as _,aq as H,l as De,ar as xe,as as I,at as D,au as Z,av as T,aw as He}from"./entry.340a11c5.js";function Me(e){var s;const n=k(e);return(s=n==null?void 0:n.$el)!=null?s:n}const M=fe?window:void 0;function R(...e){let s,n,a,u;if(typeof e[0]=="string"||Array.isArray(e[0])?([n,a,u]=e,s=M):[s,n,a,u]=e,!s)return me;Array.isArray(n)||(n=[n]),Array.isArray(a)||(a=[a]);const m=[],d=()=>{m.forEach(p=>p()),m.length=0},i=(p,h,E,S)=>(p.addEventListener(h,E,S),()=>p.removeEventListener(h,E,S)),c=pe(()=>[Me(s),k(u)],([p,h])=>{if(d(),!p)return;const E=ve(h)?{...h}:h;m.push(...n.flatMap(S=>a.map(g=>i(p,S,g,E))))},{immediate:!0,flush:"post"}),f=()=>{c(),d()};return ee(f),f}function _e(e){return typeof e=="function"?e:typeof e=="string"?s=>s.key===e:Array.isArray(e)?s=>e.includes(s.key):()=>!0}function Ve(...e){let s,n,a={};e.length===3?(s=e[0],n=e[1],a=e[2]):e.length===2?typeof e[1]=="object"?(s=!0,n=e[0],a=e[1]):(s=e[0],n=e[1]):(s=!0,n=e[0]);const{target:u=M,eventName:m="keydown",passive:d=!1,dedupe:i=!1}=a,c=_e(s);return R(u,m,p=>{p.repeat&&k(i)||c(p)&&n(p)},d)}function Ae(){const e=C(!1);return Se()&&be(()=>{e.value=!0}),e}function $e(e){const s=Ae();return y(()=>(s.value,!!e()))}function $(e,s={}){const{window:n=M}=s,a=$e(()=>n&&"matchMedia"in n&&typeof n.matchMedia=="function");let u;const m=C(!1),d=f=>{m.value=f.matches},i=()=>{u&&("removeEventListener"in u?u.removeEventListener("change",d):u.removeListener(d))},c=we(()=>{a.value&&(i(),u=n.matchMedia(k(e)),"addEventListener"in u?u.addEventListener("change",d):u.addListener(d),m.value=u.matches)});return ee(()=>{c(),i(),u=void 0}),m}const Ke={sm:640,md:768,lg:1024,xl:1280,"2xl":1536};function qe(e,s={}){function n(i,c){let f=e[i];return c!=null&&(f=ye(f,c)),typeof f=="number"&&(f=`${f}px`),f}const{window:a=M}=s;function u(i){return a?a.matchMedia(i).matches:!1}const m=i=>$(`(min-width: ${n(i)})`,s),d=Object.keys(e).reduce((i,c)=>(Object.defineProperty(i,c,{get:()=>m(c),enumerable:!0,configurable:!0}),i),{});return Object.assign(d,{greater(i){return $(`(min-width: ${n(i,.1)})`,s)},greaterOrEqual:m,smaller(i){return $(`(max-width: ${n(i,-.1)})`,s)},smallerOrEqual(i){return $(`(max-width: ${n(i)})`,s)},between(i,c){return $(`(min-width: ${n(i)}) and (max-width: ${n(c,-.1)})`,s)},isGreater(i){return u(`(min-width: ${n(i,.1)})`)},isGreaterOrEqual(i){return u(`(min-width: ${n(i)})`)},isSmaller(i){return u(`(max-width: ${n(i,-.1)})`)},isSmallerOrEqual(i){return u(`(max-width: ${n(i)})`)},isInBetween(i,c){return u(`(min-width: ${n(i)}) and (max-width: ${n(c,-.1)})`)},current(){const i=Object.keys(e).map(c=>[c,m(c)]);return y(()=>i.filter(([,c])=>c.value).map(([c])=>c))}})}const V=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},K="__vueuse_ssr_handlers__",ke=Le();function Le(){return K in V||(V[K]=V[K]||{}),V[K]}function Ne(e,s){return ke[e]||s}function Pe(e){return e==null?"any":e instanceof Set?"set":e instanceof Map?"map":e instanceof Date?"date":typeof e=="boolean"?"boolean":typeof e=="string"?"string":typeof e=="object"?"object":Number.isNaN(e)?"any":"number"}const Ye={boolean:{read:e=>e==="true",write:e=>String(e)},object:{read:e=>JSON.parse(e),write:e=>JSON.stringify(e)},number:{read:e=>Number.parseFloat(e),write:e=>String(e)},any:{read:e=>e,write:e=>String(e)},string:{read:e=>e,write:e=>String(e)},map:{read:e=>new Map(JSON.parse(e)),write:e=>JSON.stringify(Array.from(e.entries()))},set:{read:e=>new Set(JSON.parse(e)),write:e=>JSON.stringify(Array.from(e))},date:{read:e=>new Date(e),write:e=>e.toISOString()}},X="vueuse-storage";function Be(e,s,n,a={}){var u;const{flush:m="pre",deep:d=!0,listenToStorageChanges:i=!0,writeDefaults:c=!0,mergeDefaults:f=!1,shallow:p,window:h=M,eventFilter:E,onError:S=l=>{console.error(l)}}=a,g=(p?he:C)(s);if(!n)try{n=Ne("getDefaultStorage",()=>{var l;return(l=M)==null?void 0:l.localStorage})()}catch(l){S(l)}if(!n)return g;const b=k(s),j=Pe(b),x=(u=a.serializer)!=null?u:Ye[j],{pause:L,resume:N}=ge(g,()=>P(g.value),{flush:m,deep:d,eventFilter:E});return h&&i&&(R(h,"storage",A),R(h,X,W)),A(),g;function P(l){try{if(l==null)n.removeItem(e);else{const v=x.write(l),O=n.getItem(e);O!==v&&(n.setItem(e,v),h&&h.dispatchEvent(new CustomEvent(X,{detail:{key:e,oldValue:O,newValue:v,storageArea:n}})))}}catch(v){S(v)}}function J(l){const v=l?l.newValue:n.getItem(e);if(v==null)return c&&b!==null&&n.setItem(e,x.write(b)),b;if(!l&&f){const O=x.read(v);return typeof f=="function"?f(O,b):j==="object"&&!Array.isArray(O)?{...b,...O}:O}else return typeof v!="string"?v:x.read(v)}function W(l){A(l.detail)}function A(l){if(!(l&&l.storageArea!==n)){if(l&&l.key==null){g.value=b;return}if(!(l&&l.key!==e)){L();try{(l==null?void 0:l.newValue)!==x.write(g.value)&&(g.value=J(l))}catch(v){S(v)}finally{l?je(N):N()}}}}}function q(e,s,n={}){const{window:a=M}=n;return Be(e,s,a==null?void 0:a.localStorage,n)}const Je=Ee("store",()=>{var G,Q;const e=Oe(),s=Ce(),n=De(),{$moment:a}=n,{t:u}=n.$i18n,m={toFirestore(t){return delete t.id,{...t,date:a(t.date).startOf("day").toDate()}},fromFirestore(t,r){const o=xe.fromFirestore(t);return o.date=a(o.date.toDate()).format("YYYY-MM-DD"),o}},d=C(new Date().toLocaleDateString("en-CA")),i=q("filter",C("daily")),c=q("selectedTabIndex",C(0)),f=q("sort",C("name")),p=q("weekObjective",C("40:00")),h=C(!1),E=y(()=>a(d.value).startOf("week").toDate()),S=y(()=>a(d.value).endOf("week").toDate()),g=Y(s.value?B(H(e,"projects"),_("user","==",(G=s.value)==null?void 0:G.uid)):null,{ssrKey:"projects"}),b=Y(s.value?B(H(e,"priorities"),_("user","==",(Q=s.value)==null?void 0:Q.uid)):null,{ssrKey:"priorities"}),j=Y(y(()=>{var t;return s.value?B(H(e,"entries").withConverter(m),_("user","==",(t=s.value)==null?void 0:t.uid),_("date",">=",E.value),_("date","<=",S.value)):null}),{ssrKey:"entries"}),x=y(()=>[...j.value].sort((t,r)=>{const o=a(t.date+" "+t.start_time,"YYYY-M-D HH:mm");return a(r.date+" "+r.start_time,"YYYY-M-D HH:mm").isBefore(o)?1:-1}).filter(t=>a(d.value).isSame(t.date,"day"))),L=y(()=>{const t=Object.values(P.value).reduce((r,o)=>(r=a.duration(r).add(a.duration(o)),r),a.duration());return a.duration(t).format("HH:mm",{trim:!1})}),N=y(()=>a.duration(p.value).subtract(a.duration(L.value)).format("HH:mm",{trim:!1})),P=y(()=>j.value.filter(t=>!t.is_creating).reduce((t,r)=>{const o=a(r.date).locale("en").format("dddd").toLowerCase();return t[o]=a.duration(t[o]).add(a.duration(r.duration)).format("HH:mm",{trim:!1}),t},{sunday:"00:00",monday:"00:00",tuesday:"00:00",wednesday:"00:00",thursday:"00:00",friday:"00:00",saturday:"00:00"})),J=y(()=>{const t=[...j.value].filter(r=>!r.is_creating).reduce((r,o)=>{const w=o.project;return r[w.name]?r[w.name]=a.duration(r[w.name]).add(o.duration).format("HH:mm",{trim:!1}):r[w.name]=o.duration,r},{});return Object.entries(t).sort((r,o)=>a.duration(o[1]).asMilliseconds()-a.duration(r[1]).asMilliseconds())}),W=y(()=>{const t=[...j.value].filter(r=>!r.is_creating).filter(r=>a(r.date).isSame(d.value)).reduce((r,o)=>{const w=o.project;return r[w.name]?r[w.name]=a.duration(r[w.name]).add(o.duration).format("HH:mm",{trim:!1}):r[w.name]=o.duration,r},{});return Object.entries(t).sort((r,o)=>a.duration(o[1]).asMilliseconds()-a.duration(r[1]).asMilliseconds())}),A=y(()=>{const t=g.value.map(r=>[r,U(r)]);return f.value==="name"?t.sort((r,o)=>r[0].name.localeCompare(o[0].name)):t}),l=y(()=>!!j.value.find(t=>t.is_live_clocking)),v=y(()=>!!j.value.find(t=>t.is_creating)),O=y(()=>!l.value&&!v.value),te=t=>{const r=a.duration(t).asHours()===0,o=a.duration(t).asHours()>=a.duration(p.value).asHours()/5,w=a.duration(t).asHours()>=a.duration(p.value).asHours()/5-.5;return r?"text-gray-400 dark:text-gray-600":o?"text-green-500":w?"text-yellow-500":"text-red-500"},U=t=>j.value.filter(r=>{var o;return((o=r==null?void 0:r.project)==null?void 0:o.id)===t.id}).length;async function re(t){var r,o;await I(H(e,"entries").withConverter(m),{...t,user:(r=s.value)==null?void 0:r.uid,project:(o=t.project)!=null&&o.id?D(e,"projects",t.project.id):null})}async function ne(t){var r;await Z(D(e,"entries",t.id),{...t,project:(r=t.project)!=null&&r.id?D(e,"projects",t.project.id):null,date:a(t.date).startOf("day").toDate()})}async function ae(t,r=!1){(r||confirm(u("Êtes vous certain de vouloir supprimer cette entrée ?")))&&await T(D(e,"entries",t.id))}async function se(t){await Z(D(e,"entries",t.id),{is_synced:!t.is_synced})}async function ie(t){var o;return{id:(await I(H(e,"projects"),{name:t.name,user:(o=s.value)==null?void 0:o.uid})).id,name:t.name}}async function oe(t){if(confirm(u("Êtes vous certain de vouloir supprimer ce projet ?"))){const r=D(e,"projects",t.id),{promise:o}=await Y(B(H(e,"entries"),_("project","==",r)),{once:!0,wait:!0,ssrKey:"projectEntries"}),w=He(e),z=await o.value;z.length>0?confirm(u("Cela entrainera la supression de l'entrée liée, êtes-vous certain de vouloir continuer ? | Cela entrainera la supression des {n} entrées liées, êtes-vous certain de vouloir continuer ?",z.length))&&(z.forEach(de=>{w.delete(D(e,"entries",de.id))}),await w.commit(),await T(r)):await T(r)}}async function ue(t){var r;await I(H(e,"priorities"),{name:t,completed:!1,user:(r=s.value)==null?void 0:r.uid})}async function F(t,r=!1){(r||confirm(u("Êtes vous certain de vouloir supprimer cette priorité ?")))&&await T(D(e,"priorities",t.id))}function le(){const t=b.value.filter(r=>r.completed);t.length!==0?confirm(u("Êtes vous certain de vouloir supprimer les priorités complétées ?"))&&t.forEach(r=>F(r,!0)):alert(u("Aucune priorité complétée à supprimer"))}function ce(){g.value=[],b.value=[],j.value=[]}return{user:s,menuOpened:h,selectedDay:d,filter:i,selectedTabIndex:c,sort:f,weekObjective:p,projects:g,entries:j,priorities:b,weekStart:E,weekEnd:S,todaysEntries:x,weekTotal:L,weekRemaining:N,weekSummary:P,weekSummaryColors:te,weeklySummaryByProjects:J,dailySummaryByProjects:W,sortedProjects:A,projectEntriesTotal:U,isLiveClockingEntry:l,isCreatingEntry:v,canCreateEntry:O,addEntry:re,updateEntry:ne,deleteEntry:ae,toggleEntrySynced:se,addProject:ie,deleteProject:oe,addPriority:ue,deletePriority:F,deleteCompletedPriorities:le,$reset:ce}});export{qe as a,Ke as b,Ve as o,Je as u};
