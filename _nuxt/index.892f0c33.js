import{c as v,ad as ce,ae as de,U as fe,af as me,ag as k,ah as Z,r as C,ai as pe,aj as ve,ak as we,al as ye,V as he,S as ge,o as je,ab as Se,am as be,a9 as Ee,an as Y,ao as B,ap as _,aq as H,l as Oe,ar as Ce,as as I,at as D,au as G,av as T,aw as De}from"./entry.ffb9f67d.js";function xe(e){var s;const n=k(e);return(s=n==null?void 0:n.$el)!=null?s:n}const M=ce?window:void 0;function R(...e){let s,n,a,u;if(typeof e[0]=="string"||Array.isArray(e[0])?([n,a,u]=e,s=M):[s,n,a,u]=e,!s)return de;Array.isArray(n)||(n=[n]),Array.isArray(a)||(a=[a]);const m=[],d=()=>{m.forEach(p=>p()),m.length=0},i=(p,h,E,S)=>(p.addEventListener(h,E,S),()=>p.removeEventListener(h,E,S)),c=fe(()=>[xe(s),k(u)],([p,h])=>{if(d(),!p)return;const E=me(h)?{...h}:h;m.push(...n.flatMap(S=>a.map(g=>i(p,S,g,E))))},{immediate:!0,flush:"post"}),f=()=>{c(),d()};return Z(f),f}function He(e){return typeof e=="function"?e:typeof e=="string"?s=>s.key===e:Array.isArray(e)?s=>e.includes(s.key):()=>!0}function Be(...e){let s,n,a={};e.length===3?(s=e[0],n=e[1],a=e[2]):e.length===2?typeof e[1]=="object"?(s=!0,n=e[0],a=e[1]):(s=e[0],n=e[1]):(s=!0,n=e[0]);const{target:u=M,eventName:m="keydown",passive:d=!1,dedupe:i=!1}=a,c=He(s);return R(u,m,p=>{p.repeat&&k(i)||c(p)&&n(p)},d)}function Me(){const e=C(!1);return ge()&&je(()=>{e.value=!0}),e}function _e(e){const s=Me();return v(()=>(s.value,!!e()))}function $(e,s={}){const{window:n=M}=s,a=_e(()=>n&&"matchMedia"in n&&typeof n.matchMedia=="function");let u;const m=C(!1),d=f=>{m.value=f.matches},i=()=>{u&&("removeEventListener"in u?u.removeEventListener("change",d):u.removeListener(d))},c=pe(()=>{a.value&&(i(),u=n.matchMedia(k(e)),"addEventListener"in u?u.addEventListener("change",d):u.addListener(d),m.value=u.matches)});return Z(()=>{c(),i(),u=void 0}),m}const Te={sm:640,md:768,lg:1024,xl:1280,"2xl":1536};function Ve(e,s={}){function n(i,c){let f=e[i];return c!=null&&(f=ve(f,c)),typeof f=="number"&&(f=`${f}px`),f}const{window:a=M}=s;function u(i){return a?a.matchMedia(i).matches:!1}const m=i=>$(`(min-width: ${n(i)})`,s),d=Object.keys(e).reduce((i,c)=>(Object.defineProperty(i,c,{get:()=>m(c),enumerable:!0,configurable:!0}),i),{});return Object.assign(d,{greater(i){return $(`(min-width: ${n(i,.1)})`,s)},greaterOrEqual:m,smaller(i){return $(`(max-width: ${n(i,-.1)})`,s)},smallerOrEqual(i){return $(`(max-width: ${n(i)})`,s)},between(i,c){return $(`(min-width: ${n(i)}) and (max-width: ${n(c,-.1)})`,s)},isGreater(i){return u(`(min-width: ${n(i,.1)})`)},isGreaterOrEqual(i){return u(`(min-width: ${n(i)})`)},isSmaller(i){return u(`(max-width: ${n(i,-.1)})`)},isSmallerOrEqual(i){return u(`(max-width: ${n(i)})`)},isInBetween(i,c){return u(`(min-width: ${n(i)}) and (max-width: ${n(c,-.1)})`)},current(){const i=Object.keys(e).map(c=>[c,m(c)]);return v(()=>i.filter(([,c])=>c.value).map(([c])=>c))}})}const V=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},K="__vueuse_ssr_handlers__",Ae=$e();function $e(){return K in V||(V[K]=V[K]||{}),V[K]}function ke(e,s){return Ae[e]||s}function Le(e){return e==null?"any":e instanceof Set?"set":e instanceof Map?"map":e instanceof Date?"date":typeof e=="boolean"?"boolean":typeof e=="string"?"string":typeof e=="object"?"object":Number.isNaN(e)?"any":"number"}const Ne={boolean:{read:e=>e==="true",write:e=>String(e)},object:{read:e=>JSON.parse(e),write:e=>JSON.stringify(e)},number:{read:e=>Number.parseFloat(e),write:e=>String(e)},any:{read:e=>e,write:e=>String(e)},string:{read:e=>e,write:e=>String(e)},map:{read:e=>new Map(JSON.parse(e)),write:e=>JSON.stringify(Array.from(e.entries()))},set:{read:e=>new Set(JSON.parse(e)),write:e=>JSON.stringify(Array.from(e))},date:{read:e=>new Date(e),write:e=>e.toISOString()}},Q="vueuse-storage";function Pe(e,s,n,a={}){var u;const{flush:m="pre",deep:d=!0,listenToStorageChanges:i=!0,writeDefaults:c=!0,mergeDefaults:f=!1,shallow:p,window:h=M,eventFilter:E,onError:S=l=>{console.error(l)}}=a,g=(p?we:C)(s);if(!n)try{n=ke("getDefaultStorage",()=>{var l;return(l=M)==null?void 0:l.localStorage})()}catch(l){S(l)}if(!n)return g;const b=k(s),j=Le(b),x=(u=a.serializer)!=null?u:Ne[j],{pause:L,resume:N}=ye(g,()=>P(g.value),{flush:m,deep:d,eventFilter:E});return h&&i&&(R(h,"storage",A),R(h,Q,W)),A(),g;function P(l){try{if(l==null)n.removeItem(e);else{const w=x.write(l),O=n.getItem(e);O!==w&&(n.setItem(e,w),h&&h.dispatchEvent(new CustomEvent(Q,{detail:{key:e,oldValue:O,newValue:w,storageArea:n}})))}}catch(w){S(w)}}function J(l){const w=l?l.newValue:n.getItem(e);if(w==null)return c&&b!==null&&n.setItem(e,x.write(b)),b;if(!l&&f){const O=x.read(w);return typeof f=="function"?f(O,b):j==="object"&&!Array.isArray(O)?{...b,...O}:O}else return typeof w!="string"?w:x.read(w)}function W(l){A(l.detail)}function A(l){if(!(l&&l.storageArea!==n)){if(l&&l.key==null){g.value=b;return}if(!(l&&l.key!==e)){L();try{(l==null?void 0:l.newValue)!==x.write(g.value)&&(g.value=J(l))}catch(w){S(w)}finally{l?he(N):N()}}}}}function q(e,s,n={}){const{window:a=M}=n;return Pe(e,s,a==null?void 0:a.localStorage,n)}const Ke=Se("store",()=>{const e=be(),s=Ee(),n=Oe(),{$moment:a}=n,{t:u}=n.$i18n,m={toFirestore(t){return delete t.id,{...t,date:a(t.date).startOf("day").toDate()}},fromFirestore(t,r){const o=Ce.fromFirestore(t);return o.date=a(o.date.toDate()).format("YYYY-MM-DD"),o}},d=C(new Date().toLocaleDateString("en-CA")),i=q("filter",C("daily")),c=q("selectedTabIndex",C(0)),f=q("sort",C("name")),p=q("weekObjective",C("40:00")),h=C(!1),E=v(()=>a(d.value).startOf("week").toDate()),S=v(()=>a(d.value).endOf("week").toDate()),g=Y(v(()=>{var t;return s.value?B(H(e,"projects"),_("user","==",(t=s.value)==null?void 0:t.uid)):null}),{ssrKey:"projects"}),b=Y(v(()=>{var t;return s.value?B(H(e,"priorities"),_("user","==",(t=s.value)==null?void 0:t.uid)):null}),{ssrKey:"priorities"}),j=Y(v(()=>{var t;return s.value?B(H(e,"entries").withConverter(m),_("user","==",(t=s.value)==null?void 0:t.uid),_("date",">=",E.value),_("date","<=",S.value)):null}),{ssrKey:"entries"}),x=v(()=>[...j.value].sort((t,r)=>{const o=a(t.date+" "+t.start_time,"YYYY-M-D HH:mm");return a(r.date+" "+r.start_time,"YYYY-M-D HH:mm").isBefore(o)?1:-1}).filter(t=>a(d.value).isSame(t.date,"day"))),L=v(()=>{const t=Object.values(P.value).reduce((r,o)=>(r=a.duration(r).add(a.duration(o)),r),a.duration());return a.duration(t).format("HH:mm",{trim:!1})}),N=v(()=>a.duration(p.value).subtract(a.duration(L.value)).format("HH:mm",{trim:!1})),P=v(()=>j.value.filter(t=>!t.is_creating).reduce((t,r)=>{const o=a(r.date).locale("en").format("dddd").toLowerCase();return t[o]=a.duration(t[o]).add(a.duration(r.duration)).format("HH:mm",{trim:!1}),t},{sunday:"00:00",monday:"00:00",tuesday:"00:00",wednesday:"00:00",thursday:"00:00",friday:"00:00",saturday:"00:00"})),J=v(()=>{const t=[...j.value].filter(r=>!r.is_creating).reduce((r,o)=>{const y=o.project;return r[y.name]?r[y.name]=a.duration(r[y.name]).add(o.duration).format("HH:mm",{trim:!1}):r[y.name]=o.duration,r},{});return Object.entries(t).sort((r,o)=>a.duration(o[1]).asMilliseconds()-a.duration(r[1]).asMilliseconds())}),W=v(()=>{const t=[...j.value].filter(r=>!r.is_creating).filter(r=>a(r.date).isSame(d.value)).reduce((r,o)=>{const y=o.project;return r[y.name]?r[y.name]=a.duration(r[y.name]).add(o.duration).format("HH:mm",{trim:!1}):r[y.name]=o.duration,r},{});return Object.entries(t).sort((r,o)=>a.duration(o[1]).asMilliseconds()-a.duration(r[1]).asMilliseconds())}),A=v(()=>{const t=g.value.map(r=>[r,U(r)]);return f.value==="name"?t.sort((r,o)=>r[0].name.localeCompare(o[0].name)):t}),l=v(()=>!!j.value.find(t=>t.is_live_clocking)),w=v(()=>!!j.value.find(t=>t.is_creating)),O=v(()=>!l.value&&!w.value),X=t=>{const r=a.duration(t).asHours()===0,o=a.duration(t).asHours()>=a.duration(p.value).asHours()/5,y=a.duration(t).asHours()>=a.duration(p.value).asHours()/5-.5;return r?"text-gray-400 dark:text-gray-600":o?"text-green-500":y?"text-yellow-500":"text-red-500"},U=t=>j.value.filter(r=>{var o;return((o=r==null?void 0:r.project)==null?void 0:o.id)===t.id}).length;async function ee(t){var r,o;await I(H(e,"entries").withConverter(m),{...t,user:(r=s.value)==null?void 0:r.uid,project:(o=t.project)!=null&&o.id?D(e,"projects",t.project.id):null})}async function te(t){var r;await G(D(e,"entries",t.id),{...t,project:(r=t.project)!=null&&r.id?D(e,"projects",t.project.id):null,date:a(t.date).startOf("day").toDate()})}async function re(t,r=!1){(r||confirm(u("Êtes vous certain de vouloir supprimer cette entrée ?")))&&await T(D(e,"entries",t.id))}async function ne(t){await G(D(e,"entries",t.id),{is_synced:!t.is_synced})}async function ae(t){var o;return{id:(await I(H(e,"projects"),{name:t.name,user:(o=s.value)==null?void 0:o.uid})).id,name:t.name}}async function se(t){if(confirm(u("Êtes vous certain de vouloir supprimer ce projet ?"))){const r=D(e,"projects",t.id),{promise:o}=await Y(B(H(e,"entries"),_("project","==",r)),{once:!0,wait:!0,ssrKey:"projectEntries"}),y=De(e),z=await o.value;z.length>0?confirm(u("Cela entrainera la supression de l'entrée liée, êtes-vous certain de vouloir continuer ? | Cela entrainera la supression des {n} entrées liées, êtes-vous certain de vouloir continuer ?",z.length))&&(z.forEach(le=>{y.delete(D(e,"entries",le.id))}),await y.commit(),await T(r)):await T(r)}}async function ie(t){var r;await I(H(e,"priorities"),{name:t,completed:!1,user:(r=s.value)==null?void 0:r.uid})}async function F(t,r=!1){(r||confirm(u("Êtes vous certain de vouloir supprimer cette priorité ?")))&&await T(D(e,"priorities",t.id))}function oe(){const t=b.value.filter(r=>r.completed);t.length!==0?confirm(u("Êtes vous certain de vouloir supprimer les priorités complétées ?"))&&t.forEach(r=>F(r,!0)):alert(u("Aucune priorité complétée à supprimer"))}function ue(){g.value=[],b.value=[],j.value=[]}return{user:s,menuOpened:h,selectedDay:d,filter:i,selectedTabIndex:c,sort:f,weekObjective:p,projects:g,entries:j,priorities:b,weekStart:E,weekEnd:S,todaysEntries:x,weekTotal:L,weekRemaining:N,weekSummary:P,weekSummaryColors:X,weeklySummaryByProjects:J,dailySummaryByProjects:W,sortedProjects:A,projectEntriesTotal:U,isLiveClockingEntry:l,isCreatingEntry:w,canCreateEntry:O,addEntry:ee,updateEntry:te,deleteEntry:re,toggleEntrySynced:ne,addProject:ae,deleteProject:se,addPriority:ie,deletePriority:F,deleteCompletedPriorities:oe,$reset:ue}});export{Ve as a,Te as b,Be as o,Ke as u};
