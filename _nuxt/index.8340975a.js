import{c as m,ae as me,af as pe,U as ve,ag as we,ah as T,ai as Z,r as H,aj as ye,ak as he,al as ge,am as je,V as Se,S as be,o as Ee,ac as Oe,an as De,a9 as xe,ao as He,ap as O,aq as x,ar as L,as as P,at as _,l as Me,au as Ce,av as z,aw as J,ax as B,ay as _e,az as Ae,aA as ke}from"./entry.4b918e9b.js";function $e(e){var s;const a=T(e);return(s=a==null?void 0:a.$el)!=null?s:a}const M=me?window:void 0;function U(...e){let s,a,n,o;if(typeof e[0]=="string"||Array.isArray(e[0])?([a,n,o]=e,s=M):[s,a,n,o]=e,!s)return pe;Array.isArray(a)||(a=[a]),Array.isArray(n)||(n=[n]);const p=[],d=()=>{p.forEach(v=>v()),p.length=0},i=(v,g,j,b)=>(v.addEventListener(g,j,b),()=>v.removeEventListener(g,j,b)),c=ve(()=>[$e(s),T(o)],([v,g])=>{if(d(),!v)return;const j=we(g)?{...g}:g;p.push(...a.flatMap(b=>n.map(S=>i(v,b,S,j))))},{immediate:!0,flush:"post"}),f=()=>{c(),d()};return Z(f),f}function Ye(e){return typeof e=="function"?e:typeof e=="string"?s=>s.key===e:Array.isArray(e)?s=>e.includes(s.key):()=>!0}function qe(...e){let s,a,n={};e.length===3?(s=e[0],a=e[1],n=e[2]):e.length===2?typeof e[1]=="object"?(s=!0,a=e[0],n=e[1]):(s=e[0],a=e[1]):(s=!0,a=e[0]);const{target:o=M,eventName:p="keydown",passive:d=!1,dedupe:i=!1}=n,c=Ye(s);return U(o,p,v=>{v.repeat&&T(i)||c(v)&&a(v)},d)}function Te(){const e=H(!1);return be()&&Ee(()=>{e.value=!0}),e}function Ne(e){const s=Te();return m(()=>(s.value,!!e()))}function Y(e,s={}){const{window:a=M}=s,n=Ne(()=>a&&"matchMedia"in a&&typeof a.matchMedia=="function");let o;const p=H(!1),d=f=>{p.value=f.matches},i=()=>{o&&("removeEventListener"in o?o.removeEventListener("change",d):o.removeListener(d))},c=ye(()=>{n.value&&(i(),o=a.matchMedia(T(e)),"addEventListener"in o?o.addEventListener("change",d):o.addListener(d),p.value=o.matches)});return Z(()=>{c(),i(),o=void 0}),p}const ze={sm:640,md:768,lg:1024,xl:1280,"2xl":1536};function Je(e,s={}){function a(i,c){let f=e[i];return c!=null&&(f=he(f,c)),typeof f=="number"&&(f=`${f}px`),f}const{window:n=M}=s;function o(i){return n?n.matchMedia(i).matches:!1}const p=i=>Y(`(min-width: ${a(i)})`,s),d=Object.keys(e).reduce((i,c)=>(Object.defineProperty(i,c,{get:()=>p(c),enumerable:!0,configurable:!0}),i),{});return Object.assign(d,{greater(i){return Y(`(min-width: ${a(i,.1)})`,s)},greaterOrEqual:p,smaller(i){return Y(`(max-width: ${a(i,-.1)})`,s)},smallerOrEqual(i){return Y(`(max-width: ${a(i)})`,s)},between(i,c){return Y(`(min-width: ${a(i)}) and (max-width: ${a(c,-.1)})`,s)},isGreater(i){return o(`(min-width: ${a(i,.1)})`)},isGreaterOrEqual(i){return o(`(min-width: ${a(i)})`)},isSmaller(i){return o(`(max-width: ${a(i,-.1)})`)},isSmallerOrEqual(i){return o(`(max-width: ${a(i)})`)},isInBetween(i,c){return o(`(min-width: ${a(i)}) and (max-width: ${a(c,-.1)})`)},current(){const i=Object.keys(e).map(c=>[c,p(c)]);return m(()=>i.filter(([,c])=>c.value).map(([c])=>c))}})}const V=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},I="__vueuse_ssr_handlers__",Le=Pe();function Pe(){return I in V||(V[I]=V[I]||{}),V[I]}function Be(e,s){return Le[e]||s}function Ve(e){return e==null?"any":e instanceof Set?"set":e instanceof Map?"map":e instanceof Date?"date":typeof e=="boolean"?"boolean":typeof e=="string"?"string":typeof e=="object"?"object":Number.isNaN(e)?"any":"number"}const Ie={boolean:{read:e=>e==="true",write:e=>String(e)},object:{read:e=>JSON.parse(e),write:e=>JSON.stringify(e)},number:{read:e=>Number.parseFloat(e),write:e=>String(e)},any:{read:e=>e,write:e=>String(e)},string:{read:e=>e,write:e=>String(e)},map:{read:e=>new Map(JSON.parse(e)),write:e=>JSON.stringify(Array.from(e.entries()))},set:{read:e=>new Set(JSON.parse(e)),write:e=>JSON.stringify(Array.from(e))},date:{read:e=>new Date(e),write:e=>e.toISOString()}},Q="vueuse-storage";function Ke(e,s,a,n={}){var o;const{flush:p="pre",deep:d=!0,listenToStorageChanges:i=!0,writeDefaults:c=!0,mergeDefaults:f=!1,shallow:v,window:g=M,eventFilter:j,onError:b=l=>{console.error(l)}}=n,S=(v?ge:H)(s);if(!a)try{a=Be("getDefaultStorage",()=>{var l;return(l=M)==null?void 0:l.localStorage})()}catch(l){b(l)}if(!a)return S;const E=T(s),C=Ve(E),y=(o=n.serializer)!=null?o:Ie[C],{pause:K,resume:A}=je(S,()=>W(S.value),{flush:p,deep:d,eventFilter:j});return g&&i&&(U(g,"storage",k),U(g,Q,q)),k(),S;function W(l){try{if(l==null)a.removeItem(e);else{const w=y.write(l),D=a.getItem(e);D!==w&&(a.setItem(e,w),g&&g.dispatchEvent(new CustomEvent(Q,{detail:{key:e,oldValue:D,newValue:w,storageArea:a}})))}}catch(w){b(w)}}function N(l){const w=l?l.newValue:a.getItem(e);if(w==null)return c&&E!==null&&a.setItem(e,y.write(E)),E;if(!l&&f){const D=y.read(w);return typeof f=="function"?f(D,E):C==="object"&&!Array.isArray(D)?{...E,...D}:D}else return typeof w!="string"?w:y.read(w)}function q(l){k(l.detail)}function k(l){if(!(l&&l.storageArea!==a)){if(l&&l.key==null){S.value=E;return}if(!(l&&l.key!==e)){K();try{(l==null?void 0:l.newValue)!==y.write(S.value)&&(S.value=N(l))}catch(w){b(w)}finally{l?Se(A):A()}}}}}function R(e,s,a={}){const{window:n=M}=a;return Ke(e,s,n==null?void 0:n.localStorage,a)}const Re=Oe("store",()=>{const e=De(),s=xe(),a=Me(),{$moment:n}=a,{t:o}=a.$i18n,p={toFirestore(t){return delete t.id,{...t,date:n(t.date).startOf("day").toDate()}},fromFirestore(t,r){const u=Ce.fromFirestore(t);return u.date=n(u.date.toDate()).format("YYYY-MM-DD"),u}},d=H(n().format("YYYY-MM-DD")),i=R("filter",H("daily")),c=R("selectedTabIndex",H(0)),f=R("sort",H("name")),v=He(m(()=>{var t;return(t=s.value)!=null&&t.uid?O(x(e,"users"),s.value.uid):null})),g=H(!1),j=m(()=>{var t;return((t=v.value)==null?void 0:t.weekTarget)||"40:00"}),b=m(()=>n(d.value).startOf("week").toDate()),S=m(()=>n(d.value).endOf("week").toDate()),E=L(m(()=>s.value?P(x(e,"projects"),_("user","==",s.value.uid)):null),{wait:!0,ssrKey:"projects"}),C=L(m(()=>s.value?P(x(e,"priorities"),_("user","==",s.value.uid)):null),{wait:!0,ssrKey:"priorities"}),y=L(m(()=>s.value?P(x(e,"entries").withConverter(p),_("user","==",s.value.uid),_("date",">=",b.value),_("date","<=",S.value)):null),{wait:!0,ssrKey:"entries"}),K=m(()=>[...y.value].sort((t,r)=>{const u=n(t.date+" "+t.start_time,"YYYY-M-D HH:mm");return n(r.date+" "+r.start_time,"YYYY-M-D HH:mm").isBefore(u)?1:-1}).filter(t=>n(d.value).isSame(t.date,"day"))),A=m(()=>{const t=Object.values(N.value).reduce((r,u)=>(r=n.duration(r).add(n.duration(u)),r),n.duration());return n.duration(t).format("HH:mm",{trim:!1})}),W=m(()=>n.duration(j.value).subtract(n.duration(A.value)).format("HH:mm",{trim:!1})),N=m(()=>y.value.filter(t=>!t.is_creating).reduce((t,r)=>{const u=n(r.date).locale("en").format("dddd").toLowerCase();return t[u]=n.duration(t[u]).add(n.duration(r.duration)).format("HH:mm",{trim:!1}),t},{sunday:"00:00",monday:"00:00",tuesday:"00:00",wednesday:"00:00",thursday:"00:00",friday:"00:00",saturday:"00:00"})),q=m(()=>{const t=[...y.value].filter(r=>!r.is_creating).reduce((r,u)=>{const h=u.project;return r[h.name]?r[h.name]=n.duration(r[h.name]).add(u.duration).format("HH:mm",{trim:!1}):r[h.name]=u.duration,r},{});return Object.entries(t).sort((r,u)=>n.duration(u[1]).asMilliseconds()-n.duration(r[1]).asMilliseconds())}),k=m(()=>{const t=[...y.value].filter(r=>!r.is_creating).filter(r=>n(r.date).isSame(d.value)).reduce((r,u)=>{const h=u.project;return r[h.name]?r[h.name]=n.duration(r[h.name]).add(u.duration).format("HH:mm",{trim:!1}):r[h.name]=u.duration,r},{});return Object.entries(t).sort((r,u)=>n.duration(u[1]).asMilliseconds()-n.duration(r[1]).asMilliseconds())}),l=m(()=>{const t=E.value.map(r=>[r,G(r)]);return f.value==="name"?t.sort((r,u)=>r[0].name.localeCompare(u[0].name)):t}),w=m(()=>!!y.value.find(t=>t.is_live_clocking)),D=m(()=>!!y.value.find(t=>t.is_creating)),X=m(()=>!w.value&&!D.value),ee=t=>{const r=n.duration(t).asHours()===0,u=n.duration(t).asHours()===n.duration(j.value).asHours()/5,h=n.duration(t).asHours()>n.duration(j.value).asHours()/5,$=n.duration(t).asHours()>=n.duration(j.value).asHours()/5-.5;return r?"text-gray-400 dark:text-gray-600":h?"text-lime-500":u?"text-green-500":$?"text-yellow-500":"text-red-500"},G=t=>y.value.filter(r=>{var u;return((u=r==null?void 0:r.project)==null?void 0:u.id)===t.id}).length;async function te(t){var r;await z(x(e,"entries").withConverter(p),{...t,user:s.value.uid,project:(r=t.project)!=null&&r.id?O(e,"projects",t.project.id):null})}async function re(t){var r;await J(O(e,"entries",t.id),{...t,project:(r=t.project)!=null&&r.id?O(e,"projects",t.project.id):null,date:n(t.date).startOf("day").toDate()})}async function ne(t,r=!1){(r||confirm(o("Êtes vous certain de vouloir supprimer cette entrée ?")))&&await B(O(e,"entries",t.id))}async function ae(t){await J(O(e,"entries",t.id),{is_synced:!t.is_synced})}async function se(t){return{id:(await z(x(e,"projects"),{name:t.name,user:s.value.uid})).id,name:t.name}}async function ie(t){if(confirm(o("Êtes vous certain de vouloir supprimer ce projet ?"))){const r=O(e,"projects",t.id),{promise:u}=await L(P(x(e,"entries"),_("project","==",r)),{once:!0,wait:!0,ssrKey:"projectEntries"}),h=_e(e),$=await u.value;$.length>0?confirm(o("Cela entrainera la supression de l'entrée liée, êtes-vous certain de vouloir continuer ? | Cela entrainera la supression des {n} entrées liées, êtes-vous certain de vouloir continuer ?",$.length))&&($.forEach(fe=>{h.delete(O(e,"entries",fe.id))}),await h.commit(),await B(r)):await B(r)}}async function oe(t){await z(x(e,"priorities"),{name:t,completed:!1,user:s.value.uid})}async function F(t,r=!1){(r||confirm(o("Êtes vous certain de vouloir supprimer cette priorité ?")))&&await B(O(e,"priorities",t.id))}function ue(){const t=C.value.filter(r=>r.completed);t.length!==0?confirm(o("Êtes vous certain de vouloir supprimer les priorités complétées ?"))&&t.forEach(r=>F(r,!0)):alert(o("Aucune priorité complétée à supprimer"))}async function le(t){const r=O(e,"users",t.user.uid);(await Ae(r)).exists()||await ke(r,{weekTarget:"40:00"})}async function ce(t){await J(O(e,"users",s.value.uid),{weekTarget:t})}function de(){E.value=[],C.value=[],y.value=[],v.value={}}return{user:s,menuOpened:g,selectedDay:d,filter:i,selectedTabIndex:c,sort:f,userInfo:v,projects:E,entries:y,priorities:C,weekTarget:j,weekStart:b,weekEnd:S,todaysEntries:K,weekTotal:A,weekRemaining:W,weekSummary:N,weekSummaryColors:ee,weeklySummaryByProjects:q,dailySummaryByProjects:k,sortedProjects:l,projectEntriesTotal:G,isLiveClockingEntry:w,isCreatingEntry:D,canCreateEntry:X,addEntry:te,updateEntry:re,deleteEntry:ne,toggleEntrySynced:ae,addProject:se,deleteProject:ie,addPriority:oe,deletePriority:F,deleteCompletedPriorities:ue,createUserInfo:le,updateWeekTarget:ce,$reset:de}});export{Je as a,ze as b,qe as o,Re as u};
